<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- style -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/navBar.css">
    <link rel="stylesheet" href="css/grid.css">
    <link rel="stylesheet" href="css/modal.css">

    <!-- javascript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
        var documentNames = ["File one", "File two"];

        $(document).ready(function() {
            $("#so").click(function(){
                alert("Signed Out")
                window.location = "index.html";
            })
            $("#file-select").change(function(){
                document.getElementById("item-name-div").innerHTML = "File Selected";
            })
            $("#upload-button").click(function(){
                let fileName = document.getElementById("Upload-Name").value;
                let file = document.getElementById("file-select").value;
                //POST these to server
                

                document.getElementById("Upload-Name").value = "";
                file = document.getElementById("file-select").value = "";
                document.getElementById("item-name-div").innerHTML = "";
                $('.addEvidence').toggle(1000);

            })
            $('.addEvidence').toggle(1);
            $('#add-evidence-button').click(function (){
                $('.addEvidence').toggle(1000);
            })
            $('.navTrigger').click(function () {
                $(this).toggleClass('active');
                console.log("Clicked menu");
                $("#mainListDiv").toggleClass("show_list");
                $("#mainListDiv").fadeIn();
            });
            var user_data = JSON.parse(localStorage.getItem('user_data'));
            var user = user_data.user;
            var pass = user_data.pass;
            var access_level = parseInt(user_data.accessLevel);
            var settings = {
                "url": "https://us-central1-aiot-fit-xlab.cloudfunctions.net/foretrackrviewledger",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/json"
            },
                "data": JSON.stringify({"user":user,"pass":pass,"access":access_level}),
            };

            $.ajax(settings).done(function (response) {
                data = JSON.parse(response)
                var ledger = data.ledger;
                var temp = document.getElementById("item");
                var clon = temp.content.cloneNode(true);
                var elem = document.getElementsByClassName("data-container")[0];
                
                var strHMTL = "<div>";
                for (file of ledger){
                    strHMTL+="<center><br>"
                    strHMTL+= "<b>Access Type: </b>" + file.type + "<br>";
                    strHMTL+= "<b>User: </b>" + file.user + "<br>";
                    strHMTL+= "<b>Time: </b>" + file.timeUTC + "<br>";
                    strHMTL+= "<b>Hash: </b>" + file.hash_of_evidence + "<br>";
                    strHMTL+= "<b>Is Hash Identical: </b>" + file.is_hash_identical + "<br>";
                    strHMTL+= "<b>Previous Hashed Ledger: </b>" + file.previous_hashed_ledger + "<br>";
                    strHMTL+="</center><br>"
                    // documentNames.append(file.name)
                }
                strHMTL+="</div>"
                element = document.createElement("div")
                element.innerHTML = strHMTL;
                // alert(clon)
                // alert(clon.getElementById("lastAccess"))
                clon.getElementById("allAccesses").appendChild(element);
                elem.appendChild(clon);
                
                // alert(clon.getElementsByClassName("allAccesses")[0]);
                // .innerHTML = strHMTL;
            });

            
        });
    </script>
</head>
<body class="darkbgimg">
    <div class="darkbgimg">
    <nav class="nav">
        <div class="container">
            <!-- <div class="logo">
                <a href="#"><button class= "logo">ForeTrackR</button></a>
            </div> -->
            <div id="mainListDiv" class="main_list">
                <ul class="navlinks nav3 bottom-purple">
                    <li><a href="#description">About</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Contact</a></li>
                    <li>
                        <div class="Sign out">
                            <button class="sign-in dropbtn" id="so">Sign out</button>
                      </div>
                    </li>
                </ul>
            </div>
            <span class="navTrigger">
                <i></i>
                <i></i>
                <i></i>
            </span>
        </div>
    </nav>
    <section class="home">

        <br><br><br><br><br><br><br><br>
        


        
        <center><div class="title">View, Search, and Add Evidence Here<br>
            <br>
            <div class="search-add-evidence">
                <input type="text" class="evidenceSearch" placeholder="Search by name"> 
                <button class="add-evidence" id="add-evidence-button">Add Evidence</button>
            </div>
        </center>


        <center><div id="addEvidence" class="addEvidence">
           <br>
            <p>
                <label class="custom-file-upload">
                    <input type="file" id="file-select"/>
                    Select File
                </label>
                <input type="text" id="Upload-Name" placeholder="Upload Name" class="custom-file-upload-name">
                <br>
                <button class="upload-button" id="upload-button">Upload</button>     
                <div id="item-name-div" class="item-name-div"></div>        
            </p>
        </div></center>

        <div class="container" >
            <br><br>
            <div class="data-container custom-file-upload-name">
                <center>
                    <div class="col-xs-12"></div>
            </center>
            </div>
        </div>
    </section> 
    <!-- Jquery needed -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <br>
    <br>
<!-- Function used to shrink nav bar removing paddings and adding black background -->
    <script>
        $(window).scroll(function() {
            if ($(document).scrollTop() > 50) {
                $('.nav').addClass('affix');
                console.log("OK");
            } else {
                $('.nav').removeClass('affix');
            }
        });
    </script>
    <!-- generate html for each evidence element-->
    <!-- 
        Last access
        Original upload
        Original upload date, time , user
        Last access date , time, user
        List of all file accesses
     -->
     <template id="item">
         <div id=0>
            <div class="grid-container">
                <div class="filename" id="filename">NAME</div>
                <div class="originalUpload" id="originalUpload">Original</div>
                <div class="lastAccess" id="lastAccess">lastAccess</div>
                <div class="allAccesses" id="allAccesses">allAccesses</div>
                <div class="fileData" id="fileData">fileData</div>
            </div>
         </div>
     </template>

    
    </div>
</body>
</html>